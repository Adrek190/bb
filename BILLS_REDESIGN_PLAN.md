# ุฎุทุฉ ุฅุนุงุฏุฉ ุชุตููู ูุธุงู ุงูููุงุชูุฑ

## ๐ ูุธุฑุฉ ุนุงูุฉ
ุฅุนุงุฏุฉ ุชุตููู ูุธุงู ุงูููุงุชูุฑ ููููู ุฃูุซุฑ ุชูุธููุงู ูุณูููุฉ ูู ุงูุงุณุชุฎุฏุงู ูุน ุชูุณูู ุงูููุงุชูุฑ ุฅูู ุซูุงุซ ุตูุญุงุช ูููุตูุฉ.

## ๐๏ธ ูููู ุงูุตูุญุงุช ุงูุฌุฏูุฏ

### 1. ุงูุตูุญุงุช ุงูุซูุงุซ
```
lib/presentation/pages/bills/
โโโ unpaid_bills_page.dart      # ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ
โโโ under_review_bills_page.dart # ุงูููุงุชูุฑ ุชุญุช ุงููุฑุงุฌุนุฉ  
โโโ paid_bills_page.dart        # ุงูููุงุชูุฑ ุงููุฏููุนุฉ
```

### 2. ุชูุณูู ุงููุธุงุฆู
- **ุตูุญุฉ ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ**: ุนุฑุถ + ุฒุฑ ุฏูุน
- **ุตูุญุฉ ุงูููุงุชูุฑ ุชุญุช ุงููุฑุงุฌุนุฉ**: ุนุฑุถ ููุท
- **ุตูุญุฉ ุงูููุงุชูุฑ ุงููุฏููุนุฉ**: ุนุฑุถ ููุท

## ๐๏ธ ุชุนุฏููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช

### 1. ุญุฐู ุงูุฌุฏุงูู ุบูุฑ ุงููุณุชุฎุฏูุฉ
```sql
-- ุญุฐู ุงูุฌุฏุงูู ุงููุฏููุฉ
DROP TABLE IF EXISTS batch_bill_items CASCADE;
DROP TABLE IF EXISTS batch_bills CASCADE;
```

### 2. ุฅูุดุงุก ุฌุฏูู ุทูุจุงุช ุงูุฏูุน ุงูุฌุฏูุฏ
```sql
CREATE TABLE bill_payment_requests (
    request_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    bill_id UUID NOT NULL REFERENCES bills(bill_id) ON DELETE CASCADE,
    parent_id UUID NOT NULL REFERENCES parents(parent_id) ON DELETE CASCADE,
    bank_id UUID NOT NULL REFERENCES banks(bank_id),
    transfer_number VARCHAR(100) NOT NULL,
    receipt_image_path TEXT,
    requested_amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) DEFAULT 'pending',
    submitted_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    processed_at TIMESTAMP WITH TIME ZONE,
    processed_by UUID,
    admin_notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 3. ุฅูุดุงุก ุฌุฏูู ุงูููุงุชูุฑ ุงููุฏููุนุฉ
```sql
CREATE TABLE paid_bills (
    paid_bill_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    original_bill_id UUID NOT NULL,
    parent_id UUID NOT NULL REFERENCES parents(parent_id) ON DELETE CASCADE,
    bill_number VARCHAR(50) NOT NULL,
    bill_description TEXT NOT NULL,
    amount DECIMAL(10,2) NOT NULL,
    paid_amount DECIMAL(10,2) NOT NULL,
    bank_id UUID REFERENCES banks(bank_id),
    transfer_number VARCHAR(100),
    receipt_image_path TEXT,
    payment_date TIMESTAMP WITH TIME ZONE NOT NULL,
    admin_notes TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### 4. ุชุจุณูุท ุฌุฏูู ุงูููุงุชูุฑ ุงูุฑุฆูุณู
```sql
-- ุฅุฒุงูุฉ ุงูุฃุนูุฏุฉ ุบูุฑ ุงูุถุฑูุฑูุฉ
ALTER TABLE bills 
DROP COLUMN IF EXISTS bank_id,
DROP COLUMN IF EXISTS transfer_number,
DROP COLUMN IF EXISTS receipt_image_path,
DROP COLUMN IF EXISTS paid_amount,
DROP COLUMN IF EXISTS paid_at,
DROP COLUMN IF EXISTS payment_notes;
```

## ๐ง ุงูุฏูุงู ุงููุทููุจุฉ

### 1. ุฏุงูุฉ ุฅุฑุณุงู ุทูุจ ุฏูุน ูุงุชูุฑุฉ
```sql
CREATE FUNCTION submit_bill_payment_request(
    p_bill_id UUID,
    p_parent_id UUID,
    p_bank_id UUID,
    p_transfer_number TEXT,
    p_receipt_image_path TEXT,
    p_amount DECIMAL
) RETURNS UUID
```

### 2. ุฏุงูุฉ ุนุฑุถ ุงูููุงุชูุฑ ุชุญุช ุงููุฑุงุฌุนุฉ
```sql
CREATE FUNCTION get_bills_under_review(p_parent_id UUID)
RETURNS TABLE(...)
```

### 3. ุฏุงูุฉ ุนุฑุถ ุงูููุงุชูุฑ ุงููุฏููุนุฉ
```sql
CREATE FUNCTION get_paid_bills(p_parent_id UUID)
RETURNS TABLE(...)
```

### 4. ุฏุงูุฉ ุชุฃููุฏ ุงูุฏูุน (ููุฅุฏุงุฑุฉ)
```sql
CREATE FUNCTION approve_payment_request(p_request_id UUID)
RETURNS BOOLEAN
```

## ๐ ุงูุชุฑูุฌุฑ ุงููุทููุจ

### ุชุฑูุฌุฑ ููู ุงููุงุชูุฑุฉ ุฅูู ุงููุฏููุนุฉ ุนูุฏ ุงูููุงููุฉ
```sql
CREATE TRIGGER move_bill_to_paid
AFTER UPDATE OF status ON bill_payment_requests
FOR EACH ROW
WHEN (NEW.status = 'approved')
EXECUTE FUNCTION move_bill_to_paid_table();
```

## ๐จ ุชุตููู ูุงุฌูุฉ ุงููุณุชุฎุฏู

### 1. ุดุงุดุฉ ุงูุฏูุน ุงูููุจุซูุฉ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ๐ณ ุฏูุน ุงููุงุชูุฑุฉ                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ฆ ุงุฎุชูุงุฑ ุงูุจูู                โ
โ [ูุงุฆูุฉ ููุณุฏูุฉ ููุจููู]           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ท ุฅุฑูุงู ุตูุฑุฉ ุงูุฅูุตุงู          โ
โ [ููุทูุฉ ุฑูุน ุงูุตูุฑุฉ + ูุนุงููุฉ]      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ข ุฑูู ุงูุฅูุตุงู                 โ
โ [ุญูู ุฅุฏุฎุงู ุงููุต]                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ฐ ุงููุจูุบ ุงููุฏููุน              โ
โ [ุญูู ุซุงุจุช ุบูุฑ ูุงุจู ููุชุนุฏูู]      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ     [ุฅุฑุณุงู] [ุฅูุบุงุก]             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. ุงูุฃููููุดู ุงููุทููุจ
1. ุงุฎุชูุงุฑ ุงูุจูู โ ุธููุฑ ููุทูุฉ ุฑูุน ุงูุตูุฑุฉ
2. ุฑูุน ุงูุตูุฑุฉ โ ุธููุฑ ุญูู ุฑูู ุงูุฅูุตุงู
3. ุฅุฏุฎุงู ุงูุฑูู โ ุธููุฑ ุงููุจูุบ ูุฒุฑ ุงูุฅุฑุณุงู

## ๐ฑ ุชุทุจูู ุงููุญููู

### 1. ุงูุชููู ุจูู ุงูุตูุญุงุช
- ุงุณุชุฎุฏุงู TabBar ุฃู PageView ููุชููู
- ุฃููููุงุช ูููุฒุฉ ููู ุตูุญุฉ
- ุนุฏุงุฏุงุช ููููุงุชูุฑ ูู ูู ุชุจููุจ

### 2. ุงูุชูุงุนู ูุงูุงุณุชุฌุงุจุฉ
- Pull-to-refresh ูุชุญุฏูุซ ุงูุจูุงูุงุช
- Loading states ุฃุซูุงุก ุงูุนูููุงุช
- ุฑุณุงุฆู ูุฌุงุญ/ุฎุทุฃ ูุงุถุญุฉ

## ๐ ุงูุฃูุงู ูุงูุชุญูู

### 1. ุงูุชุญูู ูู ุงูุจูุงูุงุช
- ุงูุชุฃูุฏ ูู ููููุฉ ุงููุงุชูุฑุฉ ูููุณุชุฎุฏู
- ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ุงููุฏุฎูุฉ
- ููุน ุงูุชูุงุนุจ ูู ุงููุจุงูุบ

### 2. ุตูุงุญูุงุช ุงููุตูู
- ูู ูุณุชุฎุฏู ูุฑู ููุงุชูุฑู ููุท
- ุงูุชุญูู ูู ุงููููุฉ ูู ูู ุนูููุฉ

## ๐ ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช

### 1. ููุฎุต ุณุฑูุน
- ุนุฏุฏ ุงูููุงุชูุฑ ูู ูู ุญุงูุฉ
- ุฅุฌูุงูู ุงููุจุงูุบ ุงููุณุชุญูุฉ
- ุขุฎุฑ ุนูููุงุช ุงูุฏูุน

### 2. ุงูููุชุฑุฉ ูุงูุจุญุซ
- ููุชุฑุฉ ุญุณุจ ุงูุชุงุฑูุฎ
- ุจุญุซ ุจุฑูู ุงููุงุชูุฑุฉ
- ุชุฑุชูุจ ุญุณุจ ุงููุจูุบ ุฃู ุงูุชุงุฑูุฎ

## โ ุฎุทูุงุช ุงูุชูููุฐ

1. โ **ุฅูุดุงุก ุงูุฎุทุฉ** (ููุชูู)
2. โ **ุญุฐู ุงูุฌุฏุงูู ุงููุฏููุฉ** (ููุชูู)
3. โ **ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ** (ููุชูู)
4. โ **ุฅูุดุงุก ุงูุฏูุงู ูุงูุชุฑูุฌุฑุฒ** (ููุชูู)
5. โ **ุฅูุดุงุก ุงูุตูุญุงุช ุงูุซูุงุซ** (ููุชูู)
6. ๐ **ุชุตููู ุดุงุดุฉ ุงูุฏูุน ุงูููุจุซูุฉ** (ููุฏ ุงูุชุทููุฑ)
7. ๐ **ุงุฎุชุจุงุฑ ุงููุธุงู** (ููุฏ ุงูุชูููู)
8. ๐ **ุงูุชุญุณููุงุช ุงูููุงุฆูุฉ** (ููุฏ ุงูุงูุชุธุงุฑ)

## ๐ ุญุงูุฉ ุงููุดุฑูุน ุงูุญุงููุฉ

### โ ูุง ุชู ุฅูุฌุงุฒู:
- โ ุญุฐู ุฌุฏุงูู `batch_bills` ู `batch_bill_items`
- โ ุฅูุดุงุก ุฌุฏูู `bill_payment_requests`
- โ ุฅูุดุงุก ุฌุฏูู `paid_bills`
- โ ุชุจุณูุท ุฌุฏูู `bills` ุงูุฑุฆูุณู
- โ ุฅูุดุงุก ุฏุงูุฉ `submit_bill_payment_request`
- โ ุฅูุดุงุก ุฏุงูุฉ `get_unpaid_bills`
- โ ุฅูุดุงุก ุฏุงูุฉ `get_bills_under_review`
- โ ุฅูุดุงุก ุฏุงูุฉ `get_paid_bills`
- โ ุฅูุดุงุก ุฏุงูุฉ `approve_payment_request`
- โ ุฅูุดุงุก ุชุฑูุฌุฑ ุงูุฅุดุนุงุฑุงุช
- โ ุฅูุดุงุก ุตูุญุฉ `unpaid_bills_page.dart`
- โ ุฅูุดุงุก ุตูุญุฉ `under_review_bills_page.dart`
- โ ุฅูุดุงุก ุตูุญุฉ `paid_bills_page.dart`
- โ ุฅูุดุงุก ุตูุญุฉ `bills_main_page.dart` ุงูุฑุฆูุณูุฉ
- โ ุฅูุดุงุก ุดุงุดุฉ ุงูุฏูุน ุงูููุจุซูุฉ ุงููุชุทูุฑุฉ `payment_bottom_sheet.dart`
- โ ุชุทุจูู ุงูุฃููููุดู ูุงูุชุตููู ุงููุทููุจ
- โ ุฅูุดุงุก ูุธุงู ุฎุทูุงุช ุงูุฏูุน (ุงุฎุชูุงุฑ ุงูุจูู โ ุฑูุน ุงูุตูุฑุฉ โ ุฑูู ุงูุฅูุตุงู โ ุงูุชุฃููุฏ)

### ๐ ูุง ูุญุชุงุฌ ููุชุทููุฑ:
- ๐ ุชุทุจูู ุฑูุน ุงูุตูุฑ ุงููุนูู (image_picker)
- ๐ ุนุงุฑุถ ุงูุตูุฑ (photo_view)
- ๐ ูุธููุฉ ุชุญููู ุงูุฅูุตุงูุงุช (PDF generation)
- ๐ ุฑุจุท ุงูุตูุญุงุช ุจุงูุชุทุจูู ุงูุฑุฆูุณู (navigation)
- ๐ ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ุงูุฏูุน ุงููุจุงุดุฑุฉ
- ๐ ุชุทููุฑ ููุญุฉ ุชุญูู ุงููุฏูุฑ ูุชุฃููุฏ ุงูุฏูุนุงุช

### ๐งช ุงุฎุชุจุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- โ ุฏุงูุฉ `get_unpaid_bills` - ุชุนูู ุจูุฌุงุญ (4 ููุงุชูุฑ)
- โ ุฏุงูุฉ `get_bills_under_review` - ุชุนูู (ุจุฏูู ูุชุงุฆุฌ ุญุงููุงู)
- โ ุฏุงูุฉ `get_paid_bills` - ุชุนูู (ุจุฏูู ูุชุงุฆุฌ ุญุงููุงู)
- โ ุฏุงูุฉ `submit_bill_payment_request` - ุฌุงูุฒุฉ ููุงุฎุชุจุงุฑ
- โ ุฏุงูุฉ `approve_payment_request` - ุฌุงูุฒุฉ ููุงุฎุชุจุงุฑ

### ๐ฑ ุงููููุงุช ุงููููุดุฃุฉ:
```
lib/presentation/pages/bills/
โโโ bills_main_page.dart        # ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ ูุน ุงูุชุจููุจุงุช
โโโ unpaid_bills_page.dart      # ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ + ุฒุฑ ุงูุฏูุน
โโโ under_review_bills_page.dart # ุงูููุงุชูุฑ ุชุญุช ุงููุฑุงุฌุนุฉ
โโโ paid_bills_page.dart        # ุงูููุงุชูุฑ ุงููุฏููุนุฉ

lib/presentation/widgets/
โโโ payment_bottom_sheet.dart   # ุดุงุดุฉ ุงูุฏูุน ุงูููุจุซูุฉ ุงููุชุทูุฑุฉ

ุงููุณุชูุฏุงุช:
โโโ BILLS_REDESIGN_PLAN.md      # ุฎุทุฉ ุงูุชุทููุฑ ุงูุดุงููุฉ
โโโ BILLS_TESTING.md            # ุงุฎุชุจุงุฑุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
```

---
**๐ ููุงุญุธุฉ**: ุณูุชู ุงูุงุญุชูุงุธ ุจุตูุญุฉ ุงูููุงุชูุฑ ุงูุญุงููุฉ ููุฑุฌุน ุฃุซูุงุก ุงูุชุทููุฑ.
